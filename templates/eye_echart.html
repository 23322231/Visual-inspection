<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>調整視力測驗圖片大小</title>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
        }
        #referenceObject {
            border: 2px solid #000;
            width: 100px;
            height: 54mm; /* 信用卡高度 */
            resize: both;
            overflow: auto;
            margin: 20px auto;
        }
        .instruction {
            margin-top: 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>調整視力測驗圖片大小</h1>
    <p class="instruction">將信用卡（或已知尺寸的物品）放在螢幕上，並調整黑框使其尺寸與物品相符。</p>
    
    <div id="referenceObject"></div>
    
    <p class="instruction">調整後的寬度：<span id="widthDisplay">100</span> 像素</p>
    <p class="instruction">調整後的高度：<span id="heightDisplay">54</span> 像素</p>
    <button onclick="calculatePPI()">設定圖片大小</button>
    
    <p class="instruction">計算出的 PPI：<span id="ppiDisplay">尚未計算</span></p>
    <p class="instruction">計算出的螢幕尺寸：<span id="screenSizeDisplay">尚未計算</span> 英吋</p>
    
    <div>
        <p class="instruction">視力測驗圖片：</p>
        <img id="testImage" src="static/e_chart/right.jpg" style="display:none;" />
    </div>

    <script>
        const referenceObject = document.getElementById('referenceObject');
        const widthDisplay = document.getElementById('widthDisplay');
        const heightDisplay = document.getElementById('heightDisplay');
        const ppiDisplay = document.getElementById('ppiDisplay');
        const screenSizeDisplay = document.getElementById('screenSizeDisplay');
        const testImage = document.getElementById('testImage');
        const knownWidthCm = 8.56; // 信用卡寬度
        const knownHeightCm = 5.4;  // 信用卡高度

        // E 字圖片尺寸：最大 7.27 cm，比例 14:1
        const maxWidthCm = 7.27;  // 最大 E 字寬度
        const ratios = Array.from({ length: 14 }, (_, i) => 14 - i); // 比例 [14, 13, ..., 1]

        // 更新寬度和高度顯示
        referenceObject.addEventListener('mousemove', updateSize);
        function updateSize() {
            const width = referenceObject.offsetWidth;
            const height = referenceObject.offsetHeight;
            widthDisplay.textContent = width;
            heightDisplay.textContent = height;
        }

        // 計算 PPI 並顯示螢幕尺寸
        function calculatePPI() {
            const widthPx = referenceObject.offsetWidth;
            const widthInch = knownWidthCm / 2.54; // 公分轉英吋
            const ppi = widthPx / widthInch;  // 計算 PPI

            ppiDisplay.textContent = ppi.toFixed(2);

            const screenWidthPx = window.screen.width;
            const screenHeightPx = window.screen.height;

            const screenWidthInch = screenWidthPx / ppi;
            const screenHeightInch = screenHeightPx / ppi;
            const screenSizeInch = Math.sqrt(screenWidthInch ** 2 + screenHeightInch ** 2);

            screenSizeDisplay.textContent = screenSizeInch.toFixed(2);

            // 隨機顯示一種尺寸的 E 字圖片
            adjustTestImage(ppi);
        }

        function adjustTestImage(ppi) {
            fetch('get_eye_distance')
                .then(response => response.json())
                .then(data => {
                    console.log(data['depth']);
                })
                .catch(error => {
                    console.error('Error loading distance:', error);
                });

            const targetWidthPx = (maxWidthCm / 2.54) * ppi;  // 最大 E 字的像素寬度

            // 隨機選擇比例
            const randomIndex = Math.floor(Math.random() * ratios.length);
            const selectedRatio = ratios[randomIndex];

            // 根據比例調整 E 字寬度
            const adjustedWidthPx = targetWidthPx * (selectedRatio / 14);

            testImage.style.width = `${adjustedWidthPx}px`;
            testImage.style.display = 'block';
        }

        

        // 頁面載入時自動隨機顯示 E 字圖片
        window.onload = calculatePPI() ;
           
        
    </script>
</body>
</html>
